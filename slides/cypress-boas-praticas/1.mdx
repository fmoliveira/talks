<Header title="Boas PrÃ¡ticas Cypress" date="16 de setembro de 2020" />

<SlidePage>
    
<Cover>

# Boas PrÃ¡ticas Cypress

Como escrever testes E2E sem que o processo se torne muito repetitivo ou custoso

</Cover>

---

## Problemas Comuns

<img src="/images/flaky-test-or-broken-code.png" alt="" />

---

### Seletores muito volÃ¡teis

âŒ Nomes de classe sÃ£o detalhes de implementaÃ§Ã£o

ğŸ¤¯ Equipe do Cypress nÃ£o recomenda usar textos como seletores, diferente do RTL

---

### CÃ³digo muito repetitivo

ğŸ˜« Testes comeÃ§am a ficar gigantes

ğŸ˜ª DifÃ­cil de ler e manter os testes mais antigos

---

### Refatorar pra quÃª?

ğŸ˜¨ Pergunte isso novamente daqui um ano...

ğŸ§¹ Tarefas sempre devem ter uma margem de tempo generosa para refatoraÃ§Ã£o

---

### Testes lentos

ğŸŒ Acessar tela de login com frequÃªncia

â³ Usar a UI constantemente para gerar dados de teste

---

### CenÃ¡rios difÃ­ceis de testar

âœ‰ Envio de email

ğŸ’­ Login social

ğŸ² Backend com microserviÃ§os

---

## Boas PrÃ¡ticas

Felizmente, o Cypress investe muito em educaÃ§Ã£o!

Boas prÃ¡ticas sÃ£o amplamente documentadas no site oficial e com tech talks que podemos encontrar no YouTube.

---

### Seletores

<img src="/images/cy-best-selectors.png" alt="" />

[fmo.li/cy-best](https://fmo.li/cy-best)

---

### Seletores

âœ… API do Cypress recomenda usar test-id's

âœ… API do RTL recomenda usar textos como seletores

<img src="/images/choose-wisely.png" alt="" />

---

### Testing Library

ğŸ™

---

### Testing Library

```js
cy.findByTestId('menu').click() // vs cy.get('[data-testid=menu]').click()

cy.findByRole('button', { name: /Jackie Chan/i }).click()
cy.findByRole('button', { name: /Button Text/i }).should('exist')
cy.findByRole('button', { name: /Non-existing Button Text/i }).should(
  'not.exist'
)
cy.findByLabelText(/Label text/i, { timeout: 7000 }).should('exist')
```

[fmo.li/cy-rtl](https://fmo.li/cy-rtl)

---

### AbstraÃ§Ã£o e Reuso

ğŸŒ Custom Commands para reuso global, como: login, dropdowns, navegaÃ§Ã£o

âš¡ Utility Functions para reuso local, Ã© mais simples e evita poluir o global

[fmo.li/cy-commands](https://fmo.li/cy-commands)

---

### Fixtures

```js
// importe o conteÃºdo de uma fixture
cy.fixture('users').then((json) => {
  cy.route('GET', '/users/**', json)
})

// use um alias, que tambÃ©m importa o conteÃºdo
cy.fixture('users').as('usersJSON')
cy.route('GET', '/users/**', '@usersJSON')
this.usersJSON // alias disponÃ­vel em "this"

// atalhos recomendados para stubbing
cy.route('GET', '/users/**', 'fixture:users')
cy.route('GET', '/users/**', 'fx:users')
```

---

### Escreva Testes RÃ¡pidos

ğŸ’¡ Pegue atalhos, nem sempre isso Ã© trapaÃ§a

ğŸ”’ Login quase sempre pode ser melhorado

â›³ Feature flags definidas com stubs

ğŸ—ƒ Gere massa de dados de teste pela API

âš– EquilÃ­brio entre full-E2E e fixtures

---

### Headless Login

ğŸ”’ Tenha uma suÃ­te full-E2E para o login

ğŸ’¬ Custom command para facilitar reuso

âŒ NÃ£o repita o login full-E2E no app todo

ğŸ FaÃ§a login direto pela API

ğŸ•µï¸â€â™€ï¸ Armazene o token no Cypress.env

---

### Watch Mode

âš¡ Inicie o watch mode com `cypress open`

ğŸ‘€ Mantenha o watch mode aberto durante o dia

â² Tenha feedback em tempo real

---

### Build DiÃ¡ria Agendada

ğŸŒ Agende uma build todo dia de manhÃ£

ğŸ’¬ Poste o resultado no Slack/Discord do time

---

### Testes Visuais de RegressÃ£o

âŒ NÃ£o tente testar CSS com RTL ou Cypress

ğŸ˜ƒ Use uma ferramenta apropriada

ğŸ§° Cypress: Percy, Applitools Eyes

âš™ Storybook: Chromatic

---

### Fluxos com Envio de Email

âœ… EndereÃ§o de email com acesso via API

ğŸ“® [mailosaur.com](https://mailosaur.com)

ğŸ“® [mailtrap.io](https://mailtrap.io)

ğŸ“® [mailslurp.com](https://mailslurp.com)

---

### Login Social

âŒ Cypress nÃ£o permite acessar popups

ğŸ˜ƒ Use o puppeteer para cuidar disto

ğŸ•µï¸â€â™€ï¸ Lembre-se de guardar o token no Cypress.env

[npm.im/cypress-social-logins](http://npm.im/cypress-social-logins)

---

### Obrigado!

Siga-me no Twitter:

[@tfmoliveira](https://twitter.com/tfmoliveira)

</SlidePage>
